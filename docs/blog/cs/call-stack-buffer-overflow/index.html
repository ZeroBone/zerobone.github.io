<!DOCTYPE html>
<html lang="en"><head><title>Call Stack - buffer overflow vulnerability | ZeroBone</title><meta name="generator" content="Jekyll v4.1.1" /><meta property="og:title" content="Call Stack - buffer overflow vulnerability" /><meta name="author" content="Alexander Mayorov" /><meta property="og:locale" content="en" /><meta name="description" content="Buffer overflows are a kind of call stack vulnerability that occur when buffers are created on the stack, but accessed improperly. Buffer underruns are typically not so dangerous, because writing in the current stack frame or beyond the stack pointer will only affect local variables on that stack frame. On the other side, buffer overruns can allow the attacker to overwrite the return address and thus even modify the program’s behaviour." /><meta property="og:description" content="Buffer overflows are a kind of call stack vulnerability that occur when buffers are created on the stack, but accessed improperly. Buffer underruns are typically not so dangerous, because writing in the current stack frame or beyond the stack pointer will only affect local variables on that stack frame. On the other side, buffer overruns can allow the attacker to overwrite the return address and thus even modify the program’s behaviour." /><link rel="canonical" href="https://zerobone.net/blog/cs/call-stack-buffer-overflow/" /><meta property="og:url" content="https://zerobone.net/blog/cs/call-stack-buffer-overflow/" /><meta property="og:site_name" content="ZeroBone" /><meta property="og:image" content="https://zerobone.net/assets/img/blog/call-stack-buffer-overflow.svg" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-06-30T00:00:00+02:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://zerobone.net/assets/img/blog/call-stack-buffer-overflow.svg" /><meta property="twitter:title" content="Call Stack - buffer overflow vulnerability" /> <script type="application/ld+json"> {"headline":"Call Stack - buffer overflow vulnerability","dateModified":"2020-10-22T02:07:59+02:00","datePublished":"2019-06-30T00:00:00+02:00","url":"https://zerobone.net/blog/cs/call-stack-buffer-overflow/","mainEntityOfPage":{"@type":"WebPage","@id":"https://zerobone.net/blog/cs/call-stack-buffer-overflow/"},"@type":"BlogPosting","author":{"@type":"Person","name":"Alexander Mayorov"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://zerobone.net/assets/icons/icon.png"},"name":"Alexander Mayorov"},"description":"Buffer overflows are a kind of call stack vulnerability that occur when buffers are created on the stack, but accessed improperly. Buffer underruns are typically not so dangerous, because writing in the current stack frame or beyond the stack pointer will only affect local variables on that stack frame. On the other side, buffer overruns can allow the attacker to overwrite the return address and thus even modify the program’s behaviour.","image":"https://zerobone.net/assets/img/blog/call-stack-buffer-overflow.svg","@context":"https://schema.org"}</script><meta name="keywords" content="ZeroBone,Programming,Computer Science,Alexander,Mayorov,CS,Math"><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="ZeroBone"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="application-name" content="ZeroBone"><meta name="theme-color" content="rgb(10,41,132)"><link rel="alternate" href="https://zerobone.net/blog/cs/call-stack-buffer-overflow/" hreflang="en"><link type="application/atom+xml" rel="alternate" href="https://zerobone.net/feed.xml" title="ZeroBone" /><link rel="shortcut icon" href="/assets/icons/favicon.ico"><link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG"><link rel="dns-prefetch" href="/assets/js/search-worker-9.0.5.js" as="worker" id="_hrefSearch"><link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_katexPreload"> <noscript><link rel="stylesheet" href="/assets/bower_components/katex/dist/katex.min.css"></noscript><link rel="dns-prefetch" href="https://zerobone.disqus.com" id="_hrefDisqus"> <script>!function(e,t){"use strict";function n(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}e.loadJS=function(e,o){var r=t.createElement("script");r.src=e,o&&n(r,"load",o,{once:!0});var a=t.scripts[0];return a.parentNode.insertBefore(r,a),r},e._loaded=!1,e.loadJSDeferred=function(o,r){function a(){e._loaded=!0,r&&n(c,"load",r,{once:!0});var o=t.scripts[0];o.parentNode.insertBefore(c,o)}var c=t.createElement("script");return c.src=o,e._loaded?a():n(e,"load",a,{once:!0}),c},e.setRel=e.setRelStylesheet=function(e){function o(){this.rel="stylesheet"}n(t.getElementById(e),"load",o,{once:!0})}}(window,document); !function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this); !function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this); !function(w) { w._baseURL = '/'; w._publicPath = '/assets/js/'; w._noPushState = false; w._noDrawer = false; w._noNavbar = false; w._noToc = false; w._noSearch = false; }(window); </script> <!--[if gt IE 8]><!----><style id="_styleInline"> .clearfix,.sidebar-social::after{content:"";display:table;clear:both}.color-transition,.content .avatar,.nav-btn,.nav-btn-bar,.navbar,.message,.note-sm,#markdown-toc,.note,.hr-bottom,.hr-after::after,hr,.hr,p,body{transition:none}#_dark-mode{font-size:1.25rem}@media screen{body.light-mode{--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb}body.light-mode .content{-webkit-font-smoothing:initial;-moz-osx-font-smoothing:initial}body.dark-mode{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25)}body.dark-mode .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}@media screen and (prefers-color-scheme: dark){body{--body-color: #ccc;--body-bg: var(--dark-mode-body-bg);--border-color: var(--dark-mode-border-color);--gray: rgba(255,255,255,.5);--gray-bg: rgba(255,255,255,.033);--gray-text: rgba(255,255,255,.625);--menu-text: rgba(255,255,255,.25)}body .content{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}}html{--font-family: Noto Sans,Helvetica,Arial,sans-serif;--font-family-heading: Roboto Slab,Helvetica,Arial,sans-serif;--code-font-family: Fira Code,Menlo,Monaco,Consolas,monospace;--gray: #777;--gray-bg: rgba(0,0,0,0.025);--gray-text: #666;--menu-text: #bbb;--body-color: #333;--body-bg: #fff;--border-color: #ebebeb;--root-font-size: 15px;--root-font-size-medium: 16px;--root-font-size-large: 17px;--root-font-size-print: 8pt;--root-line-height: 1.75;--font-weight: 400;--font-weight-bold: 700;--font-weight-heading: 700;--content-width-5: 54rem;--content-margin-5: 4rem;--sidebar-width: 21rem;--half-content: 31rem;--break-point-3: 64em;--break-point-5: 86em;--break-point-dynamic: 1664px}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-family:var(--font-family);font-size:var(--root-font-size);line-height:var(--root-line-height)}body{color:var(--body-color);background-color:var(--body-bg);font-weight:var(--font-weight);overflow-y:scroll}.content img,.img,.content video,.video{max-width:100%;height:auto}.lead{margin-left:-1rem;margin-right:-1rem}img.lead,video.lead{display:block;max-width:calc(100% + 2rem);width:calc(100% + 2rem);height:auto}.heading,.f6,h6,.h6,.f5,h5,.h5,.f4,.sidebar-nav-item,h4,.h4,.post-date,.f3,h3,.h3,.f2,h2,.h2,.f1,h1,.h1{font-family:var(--font-family-heading);font-weight:var(--font-weight-heading)}.f1,h1,.h1{font-size:2rem;line-height:1.3}.f2,h2,.h2{font-size:1.5rem;line-height:1.4}.f3,h3,.h3{font-size:1.2em;line-height:1.5}.f4,.sidebar-nav-item,h4,.h4,.post-date{font-size:1.08rem}.f5,h5,.h5{font-size:1.04rem}.f6,h6,.h6{font-size:1rem}.content h1>a,.content .h1>a{text-decoration:none;border-bottom:none}@media screen and (max-width: 42em){.content h1,.content .h1{font-size:1.7rem;line-height:1.35}}@media screen and (min-width: 86em){.content h1,.content .h1{font-size:2.4rem;line-height:1.25}}@media screen and (min-width: 1664px){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{width:calc(100% + 50vw - 32rem);font-size:3rem;line-height:1.2}}@media screen and (min-width: 124em){body:not(.no-large-headings) .content h1,body:not(.no-large-headings) .content .h1{font-size:4rem;line-height:1.1}}h1,h2,h3,.h1,.h2,.h3{margin:3rem 0 1rem}h4,h5,h6,.h4,.post-date,.h5,.h6{margin:2rem 0 .5rem}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.2em;margin-top:1.5rem;margin-bottom:1.5rem;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr,.hr{border:0;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-after::after{content:"";display:block;margin:1rem 0;border-top:1px solid var(--border-color)}.hr-bottom{border-bottom:1px solid var(--border-color);padding-bottom:.75rem;margin-bottom:1rem}.page{margin-bottom:3em}.page li+li{margin-top:.25rem}.page>header{position:relative;margin-bottom:1.5rem}@media screen and (min-width: 1664px){body:not(.no-third-column) .page>header>.lead+.note-sm,body:not(.no-third-column) .page>header>.lead+#markdown-toc,body:not(.no-third-column) .page>header>.lead+.note,body:not(.no-third-column) .page>header>a.no-hover+.note-sm,body:not(.no-third-column) .page>header>a.no-hover+#markdown-toc,body:not(.no-third-column) .page>header>a.no-hover+.note{position:absolute;right:-25rem;width:21rem;bottom:0;margin-bottom:0}}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:var(--gray)}.related-posts{padding-left:0;list-style:none;margin-bottom:2rem}.related-posts>li,.related-posts>li+li{margin-top:1rem}.message,.note-sm,#markdown-toc,.note{margin-bottom:1rem;padding:1rem;color:var(--gray-text);background-color:var(--gray-bg);margin-left:-1rem;margin-right:-1rem}.note-sm,#markdown-toc,.note{background:transparent;color:var(--body-color);font-size:smaller;border-left:1px solid var(--border-color);padding:1.5rem 1rem 0 1rem;margin:1rem -1rem;position:relative}.note-sm:before,#markdown-toc:before,.note:before{font-size:0.667rem;font-weight:bold;font-style:normal;letter-spacing:.025rem;text-transform:uppercase;color:var(--menu-text);position:absolute;top:0}.note-sm[title]:before,#markdown-toc[title]:before,.note[title]:before{content:attr(title) !important}.note{font-size:1rem}@media screen{body::before{content:'';width:.5rem;background:var(--gray-bg);position:fixed;left:0;top:0;bottom:0}}@media (min-width: 64em){body::before{width:21rem}}@media (min-width: 1664px){body::before{width:calc(50% - 31rem)}}@media screen and (min-width: 42em){html{font-size:var(--root-font-size-medium)}}@media screen and (min-width: 124em){html{font-size:var(--root-font-size-large)}}.fl{float:left}.fr{float:right}.mb4{margin-bottom:4rem}.mb6{margin-bottom:6rem}.mt0{margin-top:0}.mt1{margin-top:1rem}.mt2{margin-top:2rem}.mt3{margin-top:3rem}.mt4{margin-top:4rem}.pb0{padding-bottom:0}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}.sixteen-ten{position:relative}.sixteen-ten::before{display:block;content:"";width:100%;padding-top:62.5%}.sixteen-ten>*{position:absolute;top:0;left:0;right:0;bottom:0}.four-three{position:relative}.four-three::before{display:block;content:"";width:100%;padding-top:75%}.four-three>*{position:absolute;top:0;left:0;right:0;bottom:0}.sr-only{display:none}.border{border:1px solid var(--border-color)}hy-push-state a{color:var(--body-color)}@supports not ((text-decoration-thickness: initial) and (text-underline-offset: initial)){hy-push-state a{text-decoration:none;border-bottom:2px solid}}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){hy-push-state a{text-decoration-style:solid;text-underline-offset:.35rem;text-decoration-thickness:2px}}hy-push-state a.no-hover{border-bottom:none;text-decoration-thickness:unset;text-underline-offset:unset}.content a:not(.btn):not(.no-hover){border-color:var(--accent-color-faded)}@supports (text-decoration-thickness: initial) and (text-underline-offset: initial){.content a:not(.btn):not(.no-hover){text-decoration-color:var(--accent-color-faded)}}.content .aspect-ratio{overflow:hidden}.content .aspect-ratio img{margin:0;width:100%;height:100%;background-color:var(--gray-bg)}hy-drawer{width:100%;position:relative;overflow:hidden;display:block;z-index:4}@media screen and (min-width: 64em){hy-drawer{position:fixed;width:21rem;top:0;left:0;bottom:0;margin-left:0}hy-drawer.cover{position:relative;width:100%}}@media screen and (min-width: 1664px){hy-drawer{width:calc(50% - 31rem)}}.sidebar{position:relative;display:flex;justify-content:center;align-items:center;color:rgba(255,255,255,0.75);text-align:center;min-height:100vh}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2);text-decoration-color:rgba(255,255,255,0.2)}.sidebar-bg{position:absolute;top:0;left:calc(50% - 50vw);width:100vw;height:100%;background:#202020 center / cover}.sidebar-bg::after{content:"";position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,0.05)}.sidebar-bg.sidebar-overlay::after{background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 50%, rgba(32,32,32,0) 100%)}.sidebar-sticky{position:relative;z-index:3;max-width:21rem;padding:1.5rem;contain:content}.sidebar-about .avatar{margin-bottom:1.5rem}.sidebar-about>a.sidebar-title{text-decoration:none}.sidebar-about>a.sidebar-title>h2{margin:0;padding-bottom:.5rem}.sidebar-about>a.sidebar-title::after{content:'';display:block;border-bottom:2px solid;margin:0 auto .5rem;width:4rem;border-color:rgba(255,255,255,0.2);transition:border-color 250ms}.sidebar-about>a.sidebar-title:hover::after{border-color:#fff;transition:border-color 50ms}.sidebar-nav>ul{list-style:none;padding-left:0}.sidebar-nav-item{display:inline-block;margin-bottom:.5rem}@media (min-width: 64em){#_main.no-drawer #_menu{display:none}#_main.no-drawer .nav-btn-bar>:nth-child(2){border:none}}.sidebar-social>ul{display:inline-block;list-style:none;padding-left:0;margin-bottom:0}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.4rem;width:3rem;height:4rem;padding:.5rem 0;line-height:3rem;text-decoration:none;border-bottom-width:2px;border-bottom-style:solid}.sidebar-social>ul li+li{margin-top:0}.fixed-common,.fixed-bottom,.fixed-top{position:fixed;left:0;width:100%;z-index:2}.fixed-top{top:0}.fixed-bottom{bottom:0}.navbar>.content{position:relative;padding-top:0;padding-bottom:0;min-height:0;max-height:5rem}.nav-btn-bar{margin:0 -1rem;background-color:white;background-color:var(--body-bg);height:5rem;display:flex;align-items:center;position:relative}.nav-btn-bar>:first-child,.nav-btn-bar>:last-child{border:none}.nav-btn{background:none;border:none;text-decoration:none;display:flex;align-items:center;justify-content:center;width:3.25rem;height:5rem;color:var(--menu-text);border-right:1px solid var(--border-color);border-left:1px solid var(--border-color);margin-left:-1px}#markdown-toc{margin:2rem -1rem 2rem calc(-1rem + 1px);padding-left:2.5rem;padding-bottom:.5rem}#markdown-toc:before{left:1rem}@media screen and (min-width: 1664px){body:not(.no-toc) #markdown-toc{position:absolute;z-index:4;width:calc(50% - 31rem);right:0;margin:auto;overflow:auto}}.content{margin-left:auto;margin-right:auto;padding:8rem 1rem 12rem}@media screen{.content{padding-left:1.5rem;max-width:42rem;min-height:100vh}}@media screen and (min-width: 54em){.content{max-width:48rem}}@media screen and (min-width: 64em){.content{padding-left:1rem;margin-left:24rem;margin-right:3rem}}@media screen and (min-width: 86em){.content{margin-left:25rem;margin-right:4rem;max-width:54rem}}@media screen and (min-width: 1664px){.content{margin:auto}}.large-only{display:none}@media screen and (min-width: 1664px){.large-only{display:block}}.avatar{width:7rem;height:7rem;border-radius:100%;overflow:hidden;display:inline-block}.avatar img{width:100%}.content .avatar{float:right;box-sizing:content-box;border:1rem solid var(--body-bg);transition:border-color 1s ease;margin-top:-1.5rem;margin-right:-1rem}.sidebar a{text-shadow:rgba(0,0,0,0.25) 0.1rem 0.1rem 0.15rem}.note:before{content:"Note"}.page>header>.note-sm:before,.page>header>.note:before,.page>header>#markdown-toc:before{content:"Description"}#markdown-toc:before{content:"Table of Contents"}.layout-resume .note-sm:before,.layout-resume .note:before,.layout-resume #markdown-toc:before{content:"Summary"}html{--accent-color: rgb(80,178,185);--accent-color-faded: rgba(80,178,185,0.5);--accent-color-darkened: #419ba2;--theme-color: rgb(10,41,132);--dark-mode-body-bg: #282a31;--dark-mode-border-color: #34373f} .clearfix,main:not(.layout-resume) .columns::after{content:"";display:table;clear:both}.color-transition,main:not(.layout-resume) .project-card{transition:none}main:not(.layout-resume) .columns{margin-left:-1rem;display:flex;flex-wrap:wrap}main:not(.layout-resume) .column{float:left;padding-left:1rem;margin-bottom:1.5rem;width:100%;display:flex}@media screen and (min-width: 42em){main:not(.layout-resume) .columns{margin-left:-2rem;margin-right:-1rem}main:not(.layout-resume) .column-1-2{width:50%}}@media screen and (min-width: 1664px){main:not(.layout-resume) .columns-break{width:calc(50vw + 22rem)}main:not(.layout-resume) .columns-break>.column-1-2,main:not(.layout-resume) .columns-break>.column-1{width:26.5rem}}@media print{main:not(.layout-resume) .columns{display:block}main:not(.layout-resume) .column{display:block;width:50%}}main:not(.layout-resume) .project-card{width:100%;color:var(--gray-text);background-color:var(--gray-bg);padding-bottom:.75rem;position:relative;overflow:hidden;box-shadow:0.125rem 0.125rem 1rem rgba(0,0,0,0.2);contain:content;page-break-inside:avoid;transition:transform 300ms ease-out, box-shadow 300ms ease-out}main:not(.layout-resume) .project-card:hover{box-shadow:0.125rem 0.375rem 1.15rem rgba(0,0,0,0.25);transform:translateY(-0.25rem);transition:transform 150ms ease-out, box-shadow 150ms ease-out}main:not(.layout-resume) .project-card>a.flip-project{display:block}main:not(.layout-resume) .project-card>a.flip-project .project-card-img{margin-bottom:0;background-position:center;background-repeat:no-repeat;background-image:url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjkwIiB2aWV3Qm94PSIwIDAgMTYwIDkwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxnIHRyYW5zZm9ybT0ibWF0cml4KDAuMDQ4ODI4LCAwLCAwLCAwLjA0Nzk5MSwgNTQuOTk5OTczLCAyMC40MjgxNDgpIj4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTk1OS44ODQgMTI4YzAuMDQwIDAuMDM0IDAuMDgyIDAuMDc2IDAuMTE2IDAuMTE2djc2Ny43N2MtMC4wMzQgMC4wNDAtMC4wNzYgMC4wODItMC4xMTYgMC4xMTZoLTg5NS43N2MtMC4wNDAtMC4wMzQtMC4wODItMC4wNzYtMC4xMTQtMC4xMTZ2LTc2Ny43NzJjMC4wMzQtMC4wNDAgMC4wNzYtMC4wODIgMC4xMTQtMC4xMTRoODk1Ljc3ek05NjAgNjRoLTg5NmMtMzUuMiAwLTY0IDI4LjgtNjQgNjR2NzY4YzAgMzUuMiAyOC44IDY0IDY0IDY0aDg5NmMzNS4yIDAgNjQtMjguOCA2NC02NHYtNzY4YzAtMzUuMi0yOC44LTY0LTY0LTY0djB6Ii8+CiAgICA8cGF0aCBzdHlsZT0iZmlsbDpyZ2JhKDEyOCwxMjgsMTI4LC4zMykiIGQ9Ik04MzIgMjg4YzAgNTMuMDIwLTQyLjk4IDk2LTk2IDk2cy05Ni00Mi45OC05Ni05NiA0Mi45OC05NiA5Ni05NiA5NiA0Mi45OCA5NiA5NnoiLz4KICAgIDxwYXRoIHN0eWxlPSJmaWxsOnJnYmEoMTI4LDEyOCwxMjgsLjMzKSIgZD0iTTg5NiA4MzJoLTc2OHYtMTI4bDIyNC0zODQgMjU2IDMyMGg2NGwyMjQtMTkyeiIvPgogIDwvZz4KPC9zdmc+")}main:not(.layout-resume) .project-card>a.flip-project .project-card-img img{display:block}main:not(.layout-resume) .project-card a{position:relative;z-index:1}main:not(.layout-resume) .project-card a.fill-card{position:absolute;top:0;left:0;right:0;bottom:0;z-index:0}main:not(.layout-resume) .project-card>.project-card-title,main:not(.layout-resume) .project-card>.project-card-text{text-align:center;padding:0 1rem}main:not(.layout-resume) .project-card>.project-card-title{display:block;font-size:1.08rem;margin-top:.75rem;margin-bottom:.25rem;color:inherit}main:not(.layout-resume) .project-card>.project-card-text{margin:.25rem 0}main:not(.layout-resume) .column-1>.project-card>.project-card-title{font-size:1.2rem}main:not(.layout-resume) .column-1>.project-card>.project-card-text{font-size:1rem}</style><link rel="preload" as="style" href="/assets/css/hydejack-9.0.5.css" id="_stylePreload"><link rel="preload" as="style" href="/assets/icomoon/style.css" id="_iconsPreload"><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload"> <script> setRel('_stylePreload'); setRel('_iconsPreload'); /**/setRel('_fontsPreload');/**/ </script> <noscript><link rel="stylesheet" href="/assets/css/hydejack-9.0.5.css"><link rel="stylesheet" href="/assets/icomoon/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap"> </noscript> <!--<![endif]--><body class="no-break-layout"> <script> window._sunrise = 6; window._sunset = 18; !function(e,s){var a="light-mode",d="dark-mode",o=(new Date).getHours();if(!("matchMedia"in e&&e.matchMedia("(prefers-color-scheme)"))){var i=o<=e._sunrise||o>=e._sunset?d:a,t=i===d?a:d;s.body.classList.add(i),s.body.classList.remove(t)}}(window,document); </script> <hy-push-state id="_pushState" replace-selector="#_main" link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)" script-selector="script" duration="500" hashchange ><div id="_navbar" class="navbar fixed-top"><div class="content"> <span class="sr-only">Jump to:</span><div class="nav-btn-bar"> <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened"> <span class="sr-only">Navigation</span> <span class="icon-menu"></span> </a><div class="nav-span"></div></div></div></div><hr class="sr-only" hidden /><main id="_main" class="content layout-post" role="main" ><article id="post-blog-cs-call-stack-buffer-overflow" class="page post mb6" role="article"><header><h1 class="post-title flip-project-title"> Call Stack - buffer overflow vulnerability</h1><div class="post-date"> <time datetime="2019-06-30T00:00:00+02:00">30 Jun 2019</time> in <a href="/blog/cs/" class="flip-title">Computer Science</a></div><div class="lead aspect-ratio sixteen-nine flip-project-img"> <img src="/assets/img/blog/call-stack-buffer-overflow.svg" alt="Call Stack - buffer overflow vulnerability" width="864" height="486" loading="lazy" /></div></header><p>Buffer overflows are a kind of call stack vulnerability that occur when buffers are created on the stack, but accessed improperly. Buffer underruns are typically not so dangerous, because writing in the current stack frame or beyond the stack pointer will only affect local variables on that stack frame. On the other side, buffer overruns can allow the attacker to overwrite the return address and thus even modify the program’s behaviour.<h2 id="buffer-overflow">Buffer overflow</h2><p>C programmers often allocate buffers on the stack to handle user input. If the input reading logic is implemented incorrectly and has now buffer length checks, a underflow/overflow can happen. If the user input is long enouph, it will overwrite the saved <code class="language-plaintext highlighter-rouge">ebp</code> register of the previous stack frame and, what matters most, the return address.<p><img src="/assets/img/blog/call-stack-buffer-overflow.svg" alt="Stack buffer overflow" /><h2 id="example">Example</h2><div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="kt">void</span> <span class="nf">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="n">fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
	
	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	
	<span class="kt">int</span><span class="o">*</span> <span class="n">prevEbp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
	<span class="kt">int</span><span class="o">*</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	
	<span class="n">printf</span><span class="p">(</span><span class="s">"Buffer start: %p Buffer start pointer address: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Previous EBP: %p Value: %d Value as hex: %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">prevEbp</span><span class="p">,</span> <span class="o">*</span><span class="n">prevEbp</span><span class="p">,</span> <span class="o">*</span><span class="n">prevEbp</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Return address: %p Value: %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="o">*</span><span class="n">ret</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Buffer end: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
	
	<span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
	
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Ptr size: %d bytes</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">));</span>
	<span class="n">fun</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>We can calculate the return address position by taking addresses of the buffer and the function arguments. In this case we only take the pointer to the first argument, because it is added to the stack last. The previous base pointer size as well as the return address size are 4 bytes, so we can just subtract 1 (<code class="language-plaintext highlighter-rouge">4</code> bytes) from the pointer to get the return address and 2 (<code class="language-plaintext highlighter-rouge">8</code> bytes) to get the base pointer.<p>We can now compile the program with the <code class="language-plaintext highlighter-rouge">-fno-stack-protector</code> flag to disable stack protecting canary that <code class="language-plaintext highlighter-rouge">gcc</code> adds by default:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc main.c <span class="nt">-o</span> viewret <span class="nt">-fno-stack-protector</span>
</code></pre></div></div><p>By running the program I got:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ptr size: 4 bytes
Buffer start: 0061FEE8 Buffer start pointer address: 0061FEE8
Previous EBP: 0061FF08 Value: 6422312 Value as hex: 61ff28
Return address: 0061FF0C Value: 401508
Buffer end: 0061FEF8
</code></pre></div></div><p>We can easly alter the return address value now:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="n">fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
	
	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	
	<span class="kt">int</span><span class="o">*</span> <span class="n">prevEbp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
	<span class="kt">int</span><span class="o">*</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	
	<span class="n">printf</span><span class="p">(</span><span class="s">"Buffer start: %p Buffer start pointer address: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Previous EBP: %p Value: %d Value as hex: %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">prevEbp</span><span class="p">,</span> <span class="o">*</span><span class="n">prevEbp</span><span class="p">,</span> <span class="o">*</span><span class="n">prevEbp</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Return address: %p Value: %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="o">*</span><span class="n">ret</span><span class="p">);</span>
	<span class="n">printf</span><span class="p">(</span><span class="s">"Buffer end: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
	
	<span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>
	
	<span class="o">*</span><span class="n">ret</span> <span class="o">=</span> <span class="mh">0xcafeefac</span><span class="p">;</span>
	
<span class="p">}</span>
</code></pre></div></div><p>Now, if we run the program we will get a <code class="language-plaintext highlighter-rouge">segmentation fault</code> error because the function will try to jump back to the calee using an invalid address.<p>We can examine exactly how it works by running the <code class="language-plaintext highlighter-rouge">GDB</code> debugger:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gdb viewret.exe
</code></pre></div></div><p>Of course, we need to set the breakpoint at the <code class="language-plaintext highlighter-rouge">fun</code> function:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>br fun
</code></pre></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[New Thread 3388.0x3368]
[New Thread 3388.0x1a2c]
Ptr size: 4 bytes

Breakpoint 1, 0x00401416 in fun ()
</code></pre></div></div><p>By using the <code class="language-plaintext highlighter-rouge">frame</code> command we can view the saved registers if the current stack frame.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>info frame
</code></pre></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Stack level 0, frame at 0x61ff10:
 eip = 0x401416 in fun; saved eip 0x401508
 called by frame at 0x61ff30
 Arglist at 0x61ff08, args:
 Locals at 0x61ff08, Previous frame's sp is 0x61ff10
 Saved registers:
  ebp at 0x61ff08, eip at 0x61ff0c
</code></pre></div></div><p>The <code class="language-plaintext highlighter-rouge">ebp</code> register of the previous stack frame is at address <code class="language-plaintext highlighter-rouge">0x61ff08</code>, the return address - at <code class="language-plaintext highlighter-rouge">0x61ff0c</code>. The values are the same as generated by the program above.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>c
</code></pre></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Continuing.
Buffer start: 0061FEE8 Buffer start pointer address: 0061FEE8
Previous EBP: 0061FF08 Value: 6422312 Value as hex: 61ff28
Return address: 0061FF0C Value: 401508
Buffer end: 0061FEF8

Program received signal SIGSEGV, Segmentation fault.
0xcafeefac in ?? ()
</code></pre></div></div><p>By stepping over the breakpoint we can see the invalid return address that caused the segmentation fault.<h2 id="altering-variables">Altering variables</h2><p>Let’s examine another program that reads data from the standart input stream:<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	
	<span class="k">volatile</span> <span class="kt">int</span> <span class="n">zero</span><span class="p">;</span>
	
	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	
	<span class="n">zero</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	
	<span class="n">gets</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
	
	<span class="k">if</span> <span class="p">(</span><span class="n">zero</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"You changed the zero variable to %d (hex: %x)!"</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">puts</span><span class="p">(</span><span class="s">"Variable not changed."</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div><p>The <code class="language-plaintext highlighter-rouge">zero</code> variable is marked as <code class="language-plaintext highlighter-rouge">volatile</code> to prevent the compiler from optimizing it’s usage, e.g. by caching it’s value in one of the general-purpose registers.<p>By dissassembling with <code class="language-plaintext highlighter-rouge">GDB</code> we get:<pre><code class="language-assembly">0x00401410 &lt;+0&gt;:     push   ebp ; save the previous ebp register
0x00401411 &lt;+1&gt;:     mov    ebp,esp ; initializing ebp of the new stack frame
0x00401413 &lt;+3&gt;:     and    esp,0xfffffff0 ; memory aligning
0x00401416 &lt;+6&gt;:     sub    esp,0x60 ; memory allocation on the stack
0x00401419 &lt;+9&gt;:     call   0x401980 &lt;__main&gt;
0x0040141e &lt;+14&gt;:    mov    DWORD PTR [esp+0x5c],0x0 ; assign to zero
; eax = esp + 0x1c
0x00401426 &lt;+22&gt;:    lea    eax,[esp+0x1c]
; the address calculated with the previous instruction gets saved on the stack
0x0040142a &lt;+26&gt;:    mov    DWORD PTR [esp],eax
0x0040142d &lt;+29&gt;:    call   0x403ae8 &lt;gets&gt; ; gets() call
; load the value from the memory for comparison
0x00401432 &lt;+34&gt;:    mov    eax,DWORD PTR [esp+0x5c]
0x00401436 &lt;+38&gt;:    test   eax,eax ; test if it is zero
0x00401438 &lt;+40&gt;:    je     0x401458 &lt;main+72&gt; 
0x0040143a &lt;+42&gt;:    mov    edx,DWORD PTR [esp+0x5c]
; commands needed for printf
0x0040143e &lt;+46&gt;:    mov    eax,DWORD PTR [esp+0x5c]
0x00401442 &lt;+50&gt;:    mov    DWORD PTR [esp+0x8],edx
0x00401446 &lt;+54&gt;:    mov    DWORD PTR [esp+0x4],eax
0x0040144a &lt;+58&gt;:    mov    DWORD PTR [esp],0x405044
0x00401451 &lt;+65&gt;:    call   0x403ac8 &lt;printf&gt; ; success print
0x00401456 &lt;+70&gt;:    jmp    0x401464 &lt;main+84&gt; ; jump over the else branch
0x00401458 &lt;+72&gt;:    mov    DWORD PTR [esp],0x405073
0x0040145f &lt;+79&gt;:    call   0x403ac0 &lt;puts&gt; ; error print
; return with exit code 0
0x00401464 &lt;+84&gt;:    mov    eax,0x0
0x00401469 &lt;+89&gt;:    leave
0x0040146a &lt;+90&gt;:    ret
0x0040146b &lt;+91&gt;:    nop
0x0040146c &lt;+92&gt;:    xchg   ax,ax
0x0040146e &lt;+94&gt;:    xchg   ax,ax
</code></pre><p>We can set 2 breakpoints - before and after the <code class="language-plaintext highlighter-rouge">gets()</code> call.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>br <span class="k">*</span>0x0040142d
<span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>br <span class="k">*</span>0x00401432
</code></pre></div></div><p>With gdb we can define what commands to run when these breakpoints are reached:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>define hook-stop
<span class="o">&gt;</span>info registers
<span class="o">&gt;</span>x/24wx <span class="nv">$esp</span>
<span class="o">&gt;</span>x/2i <span class="nv">$eip</span>
<span class="o">&gt;</span>end
</code></pre></div></div><p>With the commands above we will see the register state, 24 machine words on the stack and two next instuctions after the instruction pointer:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eax            0x61fedc 6422236
ecx            0x4018f0 4200688
edx            0x50000018       1342177304
ebx            0x2d2000 2957312
esp            0x61fec0 0x61fec0
ebp            0x61ff28 0x61ff28
esi            0x4012d0 4199120
edi            0x4012d0 4199120
eip            0x40142d 0x40142d &lt;main+29&gt;
eflags         0x202    [ IF ]
cs             0x23     35
ss             0x2b     43
ds             0x2b     43
es             0x2b     43
fs             0x53     83
gs             0x2b     43
0x61fec0:       0x0061fedc      0x00000008      0x772c8023      0x772c801a
0x61fed0:       0xb3b6879d      0x004012d0      0x004012d0      0x00000000
0x61fee0:       0x004018f0      0x0061fed0      0x0061ff08      0x0061ffcc
0x61fef0:       0x772cdd70      0xc4e6dd59      0xfffffffe      0x772c801a
0x61ff00:       0x772c810d      0x004018f0      0x0061ff50      0x0040195b
0x61ff10:       0x004018f0      0x00000000      0x002d2000      0x00000000
=&gt; 0x40142d &lt;main+29&gt;:  call   0x403ae8 &lt;gets&gt;
   0x401432 &lt;main+34&gt;:  mov    eax,DWORD PTR [esp+0x5c]

Breakpoint 1, 0x0040142d in main ()
</code></pre></div></div><p>Now we can examine how the input affects the stack:<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>c
Continuing.
0000000000000000000000000000000000000000000
</code></pre></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eax            0x61fedc 6422236
ecx            0x772eb098       1999548568
edx            0xa      10
ebx            0x2d2000 2957312
esp            0x61fec0 0x61fec0
ebp            0x61ff28 0x61ff28
esi            0x4012d0 4199120
edi            0x4012d0 4199120
eip            0x401432 0x401432 &lt;main+34&gt;
eflags         0x216    [ PF AF IF ]
cs             0x23     35
ss             0x2b     43
ds             0x2b     43
es             0x2b     43
fs             0x53     83
gs             0x2b     43
0x61fec0:       0x0061fedc      0x00000008      0x772c8023      0x772c801a
0x61fed0:       0xb3b6879d      0x004012d0      0x004012d0      0x30303030
0x61fee0:       0x30303030      0x30303030      0x30303030      0x30303030
0x61fef0:       0x30303030      0x30303030      0x30303030      0x30303030
0x61ff00:       0x30303030      0x00303030      0x0061ff50      0x0040195b
0x61ff10:       0x004018f0      0x00000000      0x002d2000      0x00000000
=&gt; 0x401432 &lt;main+34&gt;:  mov    eax,DWORD PTR [esp+0x5c]
   0x401436 &lt;main+38&gt;:  test   eax,eax

Breakpoint 2, 0x00401432 in main ()
</code></pre></div></div><p>As we see, 43 zero-characters (ascii code <code class="language-plaintext highlighter-rouge">0x30</code>) was not enouph to get to the zero value that we want ti akter. In order to get to the value, we need 64 bytes (because the buffer size is 64). For demonstration purpuses we will use the following string as the input:<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>000011111111111111112222222222222222333333333333333344444444444456
</code></pre></div></div><p>This string contains 66 characters, so the 2 last characters <code class="language-plaintext highlighter-rouge">5</code> and <code class="language-plaintext highlighter-rouge">6</code> should overwrite the 2 least significant bytes (because memory endianness is <code class="language-plaintext highlighter-rouge">little-endian</code>) of the variable.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>c
Continuing.
000011111111111111112222222222222222333333333333333344444444444456
</code></pre></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eax            0x61fedc 6422236
ecx            0x772eb098       1999548568
edx            0xa      10
ebx            0x3f9000 4165632
esp            0x61fec0 0x61fec0
ebp            0x61ff28 0x61ff28
esi            0x4012d0 4199120
edi            0x4012d0 4199120
eip            0x401432 0x401432 &lt;main+34&gt;
eflags         0x216    [ PF AF IF ]
cs             0x23     35
ss             0x2b     43
ds             0x2b     43
es             0x2b     43
fs             0x53     83
gs             0x2b     43
0x61fec0:       0x0061fedc      0x00000008      0x772c8023      0x772c801a
0x61fed0:       0xe53b01b1      0x004012d0      0x004012d0      0x30303030
0x61fee0:       0x31313131      0x31313131      0x31313131      0x31313131
0x61fef0:       0x32323232      0x32323232      0x32323232      0x32323232
0x61ff00:       0x33333333      0x33333333      0x33333333      0x33333333
0x61ff10:       0x34343434      0x34343434      0x34343434      0x00003635
=&gt; 0x401432 &lt;main+34&gt;:  mov    eax,DWORD PTR [esp+0x5c]
   0x401436 &lt;main+38&gt;:  test   eax,eax

Breakpoint 2, 0x00401432 in main ()
</code></pre></div></div><p>By continuing we see that the variable now contains <code class="language-plaintext highlighter-rouge">0x3635</code> or <code class="language-plaintext highlighter-rouge">13877</code> in decimal.<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>c
</code></pre></div></div><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Continuing.
You changed the zero variable to 13877 (hex: 3635)![Inferior 1 (process 4848) exited normally]
Error while running hook_stop:
The program has no registers now.
</code></pre></div></div><p>In order to alter the <code class="language-plaintext highlighter-rouge">zero</code> variable we need to represent the number in the <code class="language-plaintext highlighter-rouge">little endian</code> form and write the corresponding bytes to the 65, 66, 67 and 68 offsets in in buffer.<h2 id="protection-against-buffer-overflows">Protection against buffer overflows</h2><p>Compilers and operating systems have some techniques to prevent such stack exploits. In <code class="language-plaintext highlighter-rouge">gcc</code>, for example, if the function allocates a buffer on the stack, an additional so-called <code class="language-plaintext highlighter-rouge">stack canary</code> is added. A stack canary is just a random integer generated when the function is called. Before returning the function makes sure that the canary has the same value. If the canary has been altered, the program is terminated with a fatal <code class="language-plaintext highlighter-rouge">Stack smashing detected</code> error.<p>Another technique used by operating systems is restricting code evaluation on the stack. When the stack overflow is exploited, hackers will try to overwrite the return address so that it points at the buffer location with the malicious code injected. Even if the exact address is not known, it is possible to construct a <code class="language-plaintext highlighter-rouge">NO-OP</code>-instruction slide in the stack buffer so that a jump at any address within this slide will lead to malicious code execution. Exact stack addresses are typically different after every program run because operating systems push environmental variables onto it.</article><aside class="about related mt4 mb4" role="complementary"><div class="author mt4"> <img src="/assets/icons/logo_128.png" srcset="/assets/icons/logo_128.png 1x,/assets/icons/logo_256.png 2x" alt="Alexander Mayorov" class="avatar" width="120" height="120" loading="lazy" /><h2 class="page-title hr-bottom"> About</h2><p>Computer Science student &amp; backend developer.<div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/ZeroBone" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="mailto:zerobone21@gmail.com" title="Email" class="no-mark-external"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a><li> <a href="https://vk.com/alxmay" title="VK" class="no-mark-external"> <span class="icon-vk"></span> <span class="sr-only">VK</span> </a><li> <a href="https://linkedin.com/in/zerobone" title="LinkedIn" class="no-mark-external"> <span class="icon-linkedin2"></span> <span class="sr-only">LinkedIn</span> </a></ul></div></div></aside><aside class="message message-newsletter related mb4" role="complementary"><h2>Follow this blog</h2><p>Enter your email address to follow my blog and receive notifications about new posts per email. <form action="https://tinyletter.com/ZeroBone" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/ZeroBone', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true" ><div class="form-row"><div class="col col-sm-6"> <label class="sr-only" for="tlemail">Email</label> <input class="form-control" type="email" name="email" id="tlemail" placeholder="Email address" /></div><div class="col-auto"> <input class="btn btn-primary" type="submit" value="Subscribe 🚀" /></div></div><input type="hidden" value="1" name="embed"/> </form><p class="faded">No 3rd party messages or spam.</aside><aside class="other-projects related mb0" role="complementary"><h2>Read also</h2><div class="columns"><div class="column column-1-2"><article class="project-card"> <a href="/blog/cs/numbers-are-regular-languages/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/assets/img/blog/dfa-radix2-modulo4.svg" alt="Numbers in congruence classes are regular languages" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/blog/cs/numbers-are-regular-languages/" class="flip-title">Numbers in congruence classes are regular languages</a></h3><a class="fill-card no-hover" href="/blog/cs/numbers-are-regular-languages/" tabindex="-1"><span class="sr-only">Continue reading Numbers in congruence classes are regular languages</span></a></article></div><div class="column column-1-2"><article class="project-card"> <a href="/blog/cs/regular-language-size-np-hard/" class="no-hover no-print-link flip-project" tabindex="-1"><div class="project-card-img aspect-ratio sixteen-nine flip-project-img"> <img src="/assets/img/blog/4d-boolean-cube-cnf.svg" alt="Measuring the size of a regular language is NP-Hard" width="864" height="486" loading="lazy"/></div></a><h3 class="project-card-title flip-project-title"> <a href="/blog/cs/regular-language-size-np-hard/" class="flip-title">Measuring the size of a regular language is NP-Hard</a></h3><a class="fill-card no-hover" href="/blog/cs/regular-language-size-np-hard/" tabindex="-1"><span class="sr-only">Continue reading Measuring the size of a regular language is NP-Hard</span></a></article></div></div></aside><aside class="comments related" role="complementary"><h2 class="hr-bottom">Comments</h2><div id="disqus_thread"></div><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript> <script>!function(w, d) { if (d.getElementById("disqus_thread")) { if (w.DISQUS) { w.DISQUS.reset({ reload: true, config() { this.page.url = w.location.href; this.page.title = d.title; }, }); } else { w.disqus_config = function disqusConfig() { this.page.url = w.location.href; this.page.title = d.title; }; w.loadJSDeferred(d.getElementById("_hrefDisqus").href + '/embed.js'); } } }(window, document);</script></aside><footer class="content" role="contentinfo"><hr/><p><small class="copyright">Copyright © 2020 Alexander Mayorov. All rights reserved. </small><hr class="sr-only"/></footer></main><hy-drawer id="_drawer" class="" side="left" threshold="10" noscroll ><header id="_sidebar" class="sidebar" role="banner"><div class="sidebar-bg " style="background:rgb(10,41,132)"></div><div class="sidebar-sticky"><div class="sidebar-about"> <a class="no-hover" href="/" tabindex="-1"> <img src="/assets/icons/icon.png" class="avatar" alt="ZeroBone" width="120" height="120" loading="lazy" /> </a> <a class="sidebar-title" href="/"><h2 class="h1">ZeroBone</h2></a><p class=""> I am a computer science student and a backend developer.</div><nav class="sidebar-nav heading" role="navigation"> <span class="sr-only">Navigation:</span><ul><li> <a id="_drawer--opened" href="/blog/" class="sidebar-nav-item " > Blog </a><li> <a href="/projects/" class="sidebar-nav-item " > Projects </a><li> <a href="/resume/" class="sidebar-nav-item " > Resume </a></ul></nav><div class="sidebar-social"> <span class="sr-only">Social:</span><ul><li> <a href="https://github.com/ZeroBone" title="GitHub" class="no-mark-external"> <span class="icon-github"></span> <span class="sr-only">GitHub</span> </a><li> <a href="mailto:zerobone21@gmail.com" title="Email" class="no-mark-external"> <span class="icon-mail"></span> <span class="sr-only">Email</span> </a><li> <a href="https://vk.com/alxmay" title="VK" class="no-mark-external"> <span class="icon-vk"></span> <span class="sr-only">VK</span> </a><li> <a href="https://linkedin.com/in/zerobone" title="LinkedIn" class="no-mark-external"> <span class="icon-linkedin2"></span> <span class="sr-only">LinkedIn</span> </a></ul></div></div></header></hy-drawer><hr class="sr-only" hidden /> </hy-push-state> <!--[if gt IE 10]><!----> <script nomodule>!function(){var e=document.createElement("script");if(!("noModule"in e)&&"onbeforeload"in e){var t=!1;document.addEventListener("beforeload",function(n){if(n.target===e)t=!0;else if(!n.target.hasAttribute("nomodule")||!t)return;n.preventDefault()},!0),e.type="module",e.src=".",document.head.appendChild(e),e.remove()}}(); </script> <script src="/assets/js/hydejack-9.0.5.js" type="module"></script> <script src="/assets/js/LEGACY-hydejack-9.0.5.js" nomodule defer></script> <script>!function(w, d) { w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date; /**/ ga('create', 'UA-76998425-9', 'auto'); /**/ var pushStateEl = d.getElementById('_pushState'); var timeoutId; pushStateEl.addEventListener('hy-push-state-load', function() { w.clearTimeout(timeoutId); timeoutId = w.setTimeout(function() { ga('set', 'page', w.location.pathname); ga('send', 'pageview'); }, 500); }); d.addEventListener('hy--cookies-ok', function () { w.ga(function(tracker) { w.ga("set", "anonymizeIp", undefined); localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId")); }); }); w.loadJSDeferred('https://www.google-analytics.com/analytics.js'); }(window, document);</script> <script type="module"> if ('serviceWorker' in navigator) { /**/ navigator.serviceWorker.getRegistration() .then(r => r.unregister()) .catch(() => {}); /**/ } </script> <!--<![endif]--> <script> document.getElementById('_pushState').addEventListener('hy-push-state-after', function (e) { function e(e){ (console.error?console.error:console.log).call(console,e) } function t(e){ return l.innerHTML='<a href="'+e.replace(/"/g,"&quot;")+'"></a>',l.childNodes[0].getAttribute("href") } function r(e,t){ var r=e.substr(t,2);return parseInt(r,16) } function n(e,n){ for(var o="",c=r(e,n),a=n+2;a<e.length;a+=2){ var l=r(e,a)^c; o+=String.fromCharCode(l) } return t(o) } var o="/cdn-cgi/l/email-protection#", c=".__cf_email__", a="data-cfemail", l=document.createElement("div"); !function(){ for(var t=document.getElementsByTagName("a"),r=0;r<t.length;r++) try{ var c=t[r],a=c.href.indexOf(o); a>-1&&(c.href="mailto:"+n(c.href,a+o.length)) }catch(t){ e(t) } }(), function(){ for(var t=document.querySelectorAll(c),r=0;r<t.length;r++) try{ var o=t[r],l=n(o.getAttribute(a),0),i=document.createTextNode(l); o.parentNode.replaceChild(i,o) }catch(t){ e(t) } }() }); </script><div hidden><h2 class="sr-only">Templates (for web app):</h2><template id="_animation-template"><div class="animation-main fixed-top"><div class="content"><div class="page"></div></div></div></template> <template id="_loading-template"><div class="loading nav-btn fr"> <span class="sr-only">Loading…</span> <span class="icon-cog"></span></div></template> <template id="_error-template"><div class="page"><h1 class="page-title">Oops</h1><p class="lead"> Oops, an error occurred while loading <a class="this-link" href=""></a>.</div></template> <template id="_forward-template"> <button id="_forward" class="forward nav-btn no-hover"> <span class="sr-only">Forward</span> <span class="icon-arrow-right2"></span> </button> </template> <template id="_back-template"> <button id="_back" class="back nav-btn no-hover"> <span class="sr-only">Back</span> <span class="icon-arrow-left2"></span> </button> </template> <template id="_permalink-template"> <a href="#" class="permalink"> <span class="sr-only">Permalink</span> <span class="content-hash"></span> </a> </template> <template id="_dark-mode-template"> <button id="_dark-mode" class="nav-btn no-hover" > <span class="sr-only">Dark Mode</span> <span class="icon-brightness-contrast"></span> </button> </template> <template id="_search-template"> <button id="_search" class="nav-btn no-hover"> <label class="sr-only" for="_search-input">Search</label> <span class="icon-search"></span> </button><div id="_search-box"><div class="nav-btn"> <span class="icon-search"></span></div><input id="_search-input" type="search" class="form-control form-control-lg nav-btn" placeholder="What are you looking for?" /> <button type="reset" class="nav-btn no-hover"> <span class="sr-only">Close</span> <span class="icon-cross"></span> </button></div><div id="_hits"></div></template></div></html>
