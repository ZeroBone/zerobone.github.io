<!DOCTYPE html>
<html lang="en">







<head>
  






  
    
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Call Stack - buffer overflow vulnerability | ZeroBone</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="Call Stack - buffer overflow vulnerability" />
<meta name="author" content="zerobone" />
<meta property="og:locale" content="en" />
<meta name="description" content="Buffer overflows are a kind of call stack vulnerability that occur when buffers are created on the stack, but accessed improperly. Buffer underruns are typically not so dangerous, because writing in the current stack frame or beyond the stack pointer will only affect local variables on that stack frame. On the other side, buffer overruns can allow the attacker to overwrite the return address and thus even modify the program’s behavior." />
<meta property="og:description" content="Buffer overflows are a kind of call stack vulnerability that occur when buffers are created on the stack, but accessed improperly. Buffer underruns are typically not so dangerous, because writing in the current stack frame or beyond the stack pointer will only affect local variables on that stack frame. On the other side, buffer overruns can allow the attacker to overwrite the return address and thus even modify the program’s behavior." />
<link rel="canonical" href="http://localhost:4000/blog/cs/call-stack-buffer-overflow/" />
<meta property="og:url" content="http://localhost:4000/blog/cs/call-stack-buffer-overflow/" />
<meta property="og:site_name" content="ZeroBone" />
<meta property="og:image" content="http://localhost:4000/assets/img/blog/call-stack-buffer-overflow-tmb.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-30T00:00:00+02:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="http://localhost:4000/assets/img/blog/call-stack-buffer-overflow-tmb.jpg" />
<meta property="twitter:title" content="Call Stack - buffer overflow vulnerability" />
<meta name="twitter:site" content="@ZeroBone21" />
<meta name="twitter:creator" content="@zerobone" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"zerobone"},"dateModified":"2021-03-03T00:00:00+01:00","datePublished":"2019-06-30T00:00:00+02:00","description":"Buffer overflows are a kind of call stack vulnerability that occur when buffers are created on the stack, but accessed improperly. Buffer underruns are typically not so dangerous, because writing in the current stack frame or beyond the stack pointer will only affect local variables on that stack frame. On the other side, buffer overruns can allow the attacker to overwrite the return address and thus even modify the program’s behavior.","headline":"Call Stack - buffer overflow vulnerability","image":{"srcset":{"1920w":"/assets/img/blog/call-stack-buffer-overflow-tmb.jpg","960w":"/assets/img/blog/call-stack-buffer-overflow-tmb@0,5x.jpg","480w":"/assets/img/blog/call-stack-buffer-overflow-tmb@0,25x.jpg","240w":"/assets/img/blog/call-stack-buffer-overflow-tmb@0,125x.jpg"},"url":"http://localhost:4000/assets/img/blog/call-stack-buffer-overflow-tmb.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/cs/call-stack-buffer-overflow/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/icons/icon.png"},"name":"zerobone"},"url":"http://localhost:4000/blog/cs/call-stack-buffer-overflow/"}</script>
<!-- End Jekyll SEO tag -->


  

  
    <meta name="keywords" content="ZeroBone,Alexander,Mayorov,Computer Science,CS,Mathematics,Math">
  



  <meta name="theme-color" content="rgb(10,41,132)">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">

<meta name="mobile-web-app-capable" content="yes">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="ZeroBone">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<meta name="application-name" content="ZeroBone">

<meta name="generator" content="Hydejack v9.1.6" />


<link rel="alternate" href="http://localhost:4000/blog/cs/call-stack-buffer-overflow/" hreflang="en">

<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="ZeroBone" />


<link rel="shortcut icon"    href="/assets/icons/favicon.ico">
<link rel="apple-touch-icon" href="/assets/icons/icon-192x192.png">

<link rel="manifest" href="/assets/site.webmanifest">

<link rel="dns-prefetch" href="https://fonts.googleapis.com"><link rel="dns-prefetch" href="https://fonts.gstatic.com">


  <link rel="dns-prefetch" href="https://www.google-analytics.com">


<link rel="preload" href="/assets/img/swipe.svg" as="image" id="_hrefSwipeSVG">

<link rel="dns-prefetch" href="/assets/js/search-worker-9.1.6.js" as="worker" id="_hrefSearch">

  
  <link rel="dns-prefetch" href="/assets/bower_components/katex/dist/katex.min.css" id="_katexPreload">
  <noscript><link rel="stylesheet" href="/assets/bower_components/katex/dist/katex.min.css"></noscript>




<link rel="dns-prefetch" href="https://zerobone.disqus.com" id="_hrefDisqus">


<script>!function(r,c){"use strict";function a(e,t,n,o){e.addEventListener?e.addEventListener(t,n,o):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}r.loadJS=function(e,t){var n=c.createElement("script"),e=(n.src=e,t&&a(n,"load",t,{once:!0}),c.scripts[0]);return e.parentNode.insertBefore(n,e),n},r._loaded=!1,r.loadJSDeferred=function(e,t){var n=c.createElement("script");function o(){r._loaded=!0,t&&a(n,"load",t,{once:!0});var e=c.scripts[0];e.parentNode.insertBefore(n,e)}return n.src=e,r._loaded?o():a(r,"load",o,{once:!0}),n},r.setRel=r.setRelStylesheet=function(e){a(c.getElementById(e),"load",function(){this.rel="stylesheet"},{once:!0})}}(window,document);
!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
!function(a){if(a.loadCSS){var b=loadCSS.relpreload={};if(b.support=function(){try{return a.document.createElement("link").relList.supports("preload")}catch(b){return!1}},b.poly=function(){for(var b=a.document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c];"preload"===d.rel&&"style"===d.getAttribute("as")&&(a.loadCSS(d.href,d,d.getAttribute("media")),d.rel=null)}},!b.support()){b.poly();var c=a.setInterval(b.poly,300);a.addEventListener&&a.addEventListener("load",function(){b.poly(),a.clearInterval(c)}),a.attachEvent&&a.attachEvent("onload",function(){a.clearInterval(c)})}}}(this);
!function(w) {
  w._baseURL = '/';
  w._publicPath = '/assets/js/';
  w._noPushState = false;
  w._noDrawer = false;
  w._noNavbar = true;
  w._noToc = true;
  w._noSearch = false;
  w._advertise = false;
  w._search = {
    DATA_URL: '/assets/sitedata.json?no-cache',
    STORAGE_KEY: 'mini-search/',
    INDEX_KEY: 'index--2022-09-05T00:44:00+02:00',
  };
  w._clapButton = true;
}(window);</script>



<!--[if gt IE 8]><!---->

  




<link rel="stylesheet" href="/assets/css/hydejack-9.1.6.css" id="_stylePreload">
<link rel="stylesheet" href="/assets/icomoon/style.css" id="_iconsPreload">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Slab:700%7CNoto+Sans:400,400i,700,700i&display=swap" id="_fontsPreload">



  <style id="_pageStyle">

html{--accent-color: rgb(80,178,185);--accent-color-faded: rgba(80,178,185,0.5);--accent-color-highlight: rgba(80,178,185,0.1);--accent-color-darkened: #419ba2;--theme-color: rgb(10,41,132);--dark-mode-body-bg: #282a31;--dark-mode-border-color: #333640}

</style>


<!--<![endif]-->


<!-- Add HTML tags here to be included in the head -->


</head>

<body class="no-toc no-break-layout no-large-headings no-third-column">
  


<hy-push-state
  id="_pushState"
  replace-selector="#_main"
  link-selector="a[href]:not([href^='/assets/']):not(.external):not(.no-push-state)"
  script-selector="script"
  duration="500"
  hashchange
>
  
  
  <div id="_navbar" class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <div class="nav-btn-bar">
      <a id="_menu" class="nav-btn no-hover" href="#_drawer--opened">
        <span class="sr-only">Navigation</span>
        <span class="icon-menu"></span>
      </a>
      <div class="nav-span"></div>
    </div>
  </div>
</div>
<hr class="sr-only" hidden />

  <main
  id="_main"
  class="content layout-post"
  role="main"
>
  <nav id="breadcrumbs" class="screen-only"><ul>
  
  
    <li><a href="/">home</a></li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/blog/">blog</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          
          
          <a href="/blog/cs/">cs</a>
        
      </li>
    
      <li>
        
          <span>/</span>
          <span>call-stack-buffer-overflow</span>
        
      </li>
    
  
</ul></nav>
  










<article id="post-blog-cs-call-stack-buffer-overflow" class="page post mb6" role="article">
  <header>
    <h1 class="post-title flip-project-title">
      
        Call Stack - buffer overflow vulnerability
      
    </h1>

    <div class="post-date">
      
      <span class="ellipsis mr1">
        <time datetime="2019-06-30T00:00:00+02:00">30.06.2019</time> in <a href="/blog/cs/" class="flip-title">Computer Science</a> 
      </span>
      
        
          
          
          
            
            
            <span class="ellipsis" data-tippy-content="Last modified at: 03.03.2021">
              <span class="sr-only">Last modified at:</span>
              <span class="icon-history"></span>
              <time datetime="2021-03-03T00:00:00+01:00">03.03.2021</time>
            </span>
          
        
      
    </div>

    
    
      
        <div class="img-wrapper lead aspect-ratio sixteen-nine flip-project-img">
          


<img
  
    src="/assets/img/blog/call-stack-buffer-overflow-tmb.jpg"
    srcset="/assets/img/blog/call-stack-buffer-overflow-tmb.jpg 1920w,/assets/img/blog/call-stack-buffer-overflow-tmb@0,5x.jpg 960w,/assets/img/blog/call-stack-buffer-overflow-tmb@0,25x.jpg 480w,/assets/img/blog/call-stack-buffer-overflow-tmb@0,125x.jpg 240w"
    
  
  alt="Call Stack - buffer overflow vulnerability"
  
  
  width="864"
  height="486"
  loading="lazy"
/>

        </div>
      
      
    

    



  


  </header>

  
    <p>Buffer overflows are a kind of call stack vulnerability that occur when buffers are created on the stack, but accessed improperly. Buffer underruns are typically not so dangerous, because writing in the current stack frame or beyond the stack pointer will only affect local variables on that stack frame. On the other side, buffer overruns can allow the attacker to overwrite the return address and thus even modify the program’s behavior.</p>

<h2 id="buffer-overflow">Buffer overflow</h2>

<p>C programmers often allocate buffers on the stack to handle user input. If the input reading logic is implemented incorrectly and has no buffer length checks, a underflow/overflow can happen. If the user input is long enough, it will overwrite the saved <code class="language-plaintext highlighter-rouge">ebp</code> register of the previous stack frame and, what matters most, the return address.</p>

<p><img src="/assets/img/blog/call-stack-buffer-overflow.svg" alt="Stack buffer overflow" loading="lazy" /></p>

<h2 id="example">Example</h2>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="kt">void</span> <span class="nf">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="n">fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>

    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>

    <span class="kt">int</span><span class="o">*</span> <span class="n">prevEbp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Buffer start: %p Buffer start pointer address: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Previous EBP: %p Value: %d Value as hex: %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">prevEbp</span><span class="p">,</span> <span class="o">*</span><span class="n">prevEbp</span><span class="p">,</span> <span class="o">*</span><span class="n">prevEbp</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Return address: %p Value: %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="o">*</span><span class="n">ret</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Buffer end: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>

    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>

<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Ptr size: %d bytes</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">));</span>
    <span class="n">fun</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We can calculate the return address position by taking addresses of the buffer and the function arguments. In this case we only take the pointer to the first argument, because it is added to the stack last. The previous base pointer size as well as the return address size are 4 bytes, so we can just subtract 1 (<code class="language-plaintext highlighter-rouge">4</code> bytes) from the pointer to get the return address and 2 (<code class="language-plaintext highlighter-rouge">8</code> bytes) to get the base pointer.</p>

<p>We can now compile the program with the <code class="language-plaintext highlighter-rouge">-fno-stack-protector</code> flag to disable stack protecting canary that <code class="language-plaintext highlighter-rouge">gcc</code> adds by default:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gcc main.c <span class="nt">-o</span> viewret <span class="nt">-fno-stack-protector</span>
</code></pre></div></div>

<p>By running the program I got:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Ptr size: 4 bytes
Buffer start: 0061FEE8 Buffer start pointer address: 0061FEE8
Previous EBP: 0061FF08 Value: 6422312 Value as hex: 61ff28
Return address: 0061FF0C Value: 401508
Buffer end: 0061FEF8
</code></pre></div></div>

<p>We can easily alter the return address value now:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">__attribute__</span><span class="p">((</span><span class="n">noinline</span><span class="p">))</span> <span class="n">fun</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>

    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>

    <span class="kt">int</span><span class="o">*</span> <span class="n">prevEbp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Buffer start: %p Buffer start pointer address: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buffer</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Previous EBP: %p Value: %d Value as hex: %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">prevEbp</span><span class="p">,</span> <span class="o">*</span><span class="n">prevEbp</span><span class="p">,</span> <span class="o">*</span><span class="n">prevEbp</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Return address: %p Value: %x</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="o">*</span><span class="n">ret</span><span class="p">);</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Buffer end: %p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">buffer</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>

    <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span>

    <span class="o">*</span><span class="n">ret</span> <span class="o">=</span> <span class="mh">0xcafeefac</span><span class="p">;</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Now, if we run the program we will get a <code class="language-plaintext highlighter-rouge">segmentation fault</code> error because the function will try to jump back to the calee using an invalid address.</p>

<p>We can examine exactly how it works by running the <code class="language-plaintext highlighter-rouge">GDB</code> debugger:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>gdb viewret.exe
</code></pre></div></div>

<p>Of course, we need to set the breakpoint at the <code class="language-plaintext highlighter-rouge">fun</code> function:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>br fun
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[New Thread 3388.0x3368]
[New Thread 3388.0x1a2c]
Ptr size: 4 bytes

Breakpoint 1, 0x00401416 in fun ()
</code></pre></div></div>

<p>By using the <code class="language-plaintext highlighter-rouge">frame</code> command we can view the saved registers if the current stack frame.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>info frame
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Stack level 0, frame at 0x61ff10:
 eip = 0x401416 in fun; saved eip 0x401508
 called by frame at 0x61ff30
 Arglist at 0x61ff08, args:
 Locals at 0x61ff08, Previous frame's sp is 0x61ff10
 Saved registers:
  ebp at 0x61ff08, eip at 0x61ff0c
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">ebp</code> register of the previous stack frame is at address <code class="language-plaintext highlighter-rouge">0x61ff08</code>, the return address - at <code class="language-plaintext highlighter-rouge">0x61ff0c</code>. The values are the same as generated by the program above.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>c
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Continuing.
Buffer start: 0061FEE8 Buffer start pointer address: 0061FEE8
Previous EBP: 0061FF08 Value: 6422312 Value as hex: 61ff28
Return address: 0061FF0C Value: 401508
Buffer end: 0061FEF8

Program received signal SIGSEGV, Segmentation fault.
0xcafeefac in ?? ()
</code></pre></div></div>

<p>By stepping over the breakpoint we can see the invalid return address that caused the segmentation fault.</p>

<h2 id="altering-variables">Altering variables</h2>

<p>Let’s examine another program that reads data from the standard input stream:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	
    <span class="k">volatile</span> <span class="kt">int</span> <span class="n">zero</span><span class="p">;</span>

    <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

    <span class="n">zero</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">gets</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">zero</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"You changed the zero variable to %d (hex: %x)!"</span><span class="p">,</span> <span class="n">zero</span><span class="p">,</span> <span class="n">zero</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"Variable not changed."</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">zero</code> variable is marked as <code class="language-plaintext highlighter-rouge">volatile</code> to prevent the compiler from optimizing it’s usage, e.g. by caching it’s value in one of the general-purpose registers.</p>

<p>By disassembling the program with <code class="language-plaintext highlighter-rouge">gdb</code>, we get:</p>

<pre><code class="language-assembly">0x00401410 &lt;+0&gt;:     push   ebp ; save the previous ebp register
0x00401411 &lt;+1&gt;:     mov    ebp,esp ; initializing ebp of the new stack frame
0x00401413 &lt;+3&gt;:     and    esp,0xfffffff0 ; memory aligning
0x00401416 &lt;+6&gt;:     sub    esp,0x60 ; memory allocation on the stack
0x00401419 &lt;+9&gt;:     call   0x401980 &lt;__main&gt;
0x0040141e &lt;+14&gt;:    mov    DWORD PTR [esp+0x5c],0x0 ; assign to zero
; eax = esp + 0x1c
0x00401426 &lt;+22&gt;:    lea    eax,[esp+0x1c]
; the address calculated with the previous instruction gets saved on the stack
0x0040142a &lt;+26&gt;:    mov    DWORD PTR [esp],eax
0x0040142d &lt;+29&gt;:    call   0x403ae8 &lt;gets&gt; ; gets() call
; load the value from the memory for comparison
0x00401432 &lt;+34&gt;:    mov    eax,DWORD PTR [esp+0x5c]
0x00401436 &lt;+38&gt;:    test   eax,eax ; test if it is zero
0x00401438 &lt;+40&gt;:    je     0x401458 &lt;main+72&gt; 
0x0040143a &lt;+42&gt;:    mov    edx,DWORD PTR [esp+0x5c]
; commands needed for printf
0x0040143e &lt;+46&gt;:    mov    eax,DWORD PTR [esp+0x5c]
0x00401442 &lt;+50&gt;:    mov    DWORD PTR [esp+0x8],edx
0x00401446 &lt;+54&gt;:    mov    DWORD PTR [esp+0x4],eax
0x0040144a &lt;+58&gt;:    mov    DWORD PTR [esp],0x405044
0x00401451 &lt;+65&gt;:    call   0x403ac8 &lt;printf&gt; ; success print
0x00401456 &lt;+70&gt;:    jmp    0x401464 &lt;main+84&gt; ; jump over the else branch
0x00401458 &lt;+72&gt;:    mov    DWORD PTR [esp],0x405073
0x0040145f &lt;+79&gt;:    call   0x403ac0 &lt;puts&gt; ; error print
; return with exit code 0
0x00401464 &lt;+84&gt;:    mov    eax,0x0
0x00401469 &lt;+89&gt;:    leave
0x0040146a &lt;+90&gt;:    ret
0x0040146b &lt;+91&gt;:    nop
0x0040146c &lt;+92&gt;:    xchg   ax,ax
0x0040146e &lt;+94&gt;:    xchg   ax,ax
</code></pre>

<p>We can set 2 breakpoints - before and after the <code class="language-plaintext highlighter-rouge">gets()</code> call.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>br <span class="k">*</span>0x0040142d
<span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>br <span class="k">*</span>0x00401432
</code></pre></div></div>

<p>With <code class="language-plaintext highlighter-rouge">gdb</code>, we can define what commands to run when these breakpoints are reached:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>define hook-stop
<span class="o">&gt;</span>info registers
<span class="o">&gt;</span>x/24wx <span class="nv">$esp</span>
<span class="o">&gt;</span>x/2i <span class="nv">$eip</span>
<span class="o">&gt;</span>end
</code></pre></div></div>

<p>Bu running the commands above we will see the register state, 24 machine words on the stack and two next instructions after the instruction pointer:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eax            0x61fedc 6422236
ecx            0x4018f0 4200688
edx            0x50000018       1342177304
ebx            0x2d2000 2957312
esp            0x61fec0 0x61fec0
ebp            0x61ff28 0x61ff28
esi            0x4012d0 4199120
edi            0x4012d0 4199120
eip            0x40142d 0x40142d &lt;main+29&gt;
eflags         0x202    [ IF ]
cs             0x23     35
ss             0x2b     43
ds             0x2b     43
es             0x2b     43
fs             0x53     83
gs             0x2b     43
0x61fec0:       0x0061fedc      0x00000008      0x772c8023      0x772c801a
0x61fed0:       0xb3b6879d      0x004012d0      0x004012d0      0x00000000
0x61fee0:       0x004018f0      0x0061fed0      0x0061ff08      0x0061ffcc
0x61fef0:       0x772cdd70      0xc4e6dd59      0xfffffffe      0x772c801a
0x61ff00:       0x772c810d      0x004018f0      0x0061ff50      0x0040195b
0x61ff10:       0x004018f0      0x00000000      0x002d2000      0x00000000
=&gt; 0x40142d &lt;main+29&gt;:  call   0x403ae8 &lt;gets&gt;
   0x401432 &lt;main+34&gt;:  mov    eax,DWORD PTR [esp+0x5c]

Breakpoint 1, 0x0040142d in main ()
</code></pre></div></div>

<p>Now we can examine how the input affects the stack:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>c
Continuing.
0000000000000000000000000000000000000000000
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eax            0x61fedc 6422236
ecx            0x772eb098       1999548568
edx            0xa      10
ebx            0x2d2000 2957312
esp            0x61fec0 0x61fec0
ebp            0x61ff28 0x61ff28
esi            0x4012d0 4199120
edi            0x4012d0 4199120
eip            0x401432 0x401432 &lt;main+34&gt;
eflags         0x216    [ PF AF IF ]
cs             0x23     35
ss             0x2b     43
ds             0x2b     43
es             0x2b     43
fs             0x53     83
gs             0x2b     43
0x61fec0:       0x0061fedc      0x00000008      0x772c8023      0x772c801a
0x61fed0:       0xb3b6879d      0x004012d0      0x004012d0      0x30303030
0x61fee0:       0x30303030      0x30303030      0x30303030      0x30303030
0x61fef0:       0x30303030      0x30303030      0x30303030      0x30303030
0x61ff00:       0x30303030      0x00303030      0x0061ff50      0x0040195b
0x61ff10:       0x004018f0      0x00000000      0x002d2000      0x00000000
=&gt; 0x401432 &lt;main+34&gt;:  mov    eax,DWORD PTR [esp+0x5c]
   0x401436 &lt;main+38&gt;:  test   eax,eax

Breakpoint 2, 0x00401432 in main ()
</code></pre></div></div>

<p>As we can see, 43 zero-characters (ascii code <code class="language-plaintext highlighter-rouge">0x30</code>) was not enough to get to the zero value that we want it to occur. In order to get past the end of the buffer, we need at more than 64 bytes (because the buffer size is 64). For demonstration purposes, we will use the following string as the input:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>000011111111111111112222222222222222333333333333333344444444444456
</code></pre></div></div>

<p>This string contains 66 characters, so the two last characters <code class="language-plaintext highlighter-rouge">5</code> and <code class="language-plaintext highlighter-rouge">6</code> should overwrite the 2 least significant bytes (because memory endianness is little-endian) of the variable.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>c
Continuing.
000011111111111111112222222222222222333333333333333344444444444456
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eax            0x61fedc 6422236
ecx            0x772eb098       1999548568
edx            0xa      10
ebx            0x3f9000 4165632
esp            0x61fec0 0x61fec0
ebp            0x61ff28 0x61ff28
esi            0x4012d0 4199120
edi            0x4012d0 4199120
eip            0x401432 0x401432 &lt;main+34&gt;
eflags         0x216    [ PF AF IF ]
cs             0x23     35
ss             0x2b     43
ds             0x2b     43
es             0x2b     43
fs             0x53     83
gs             0x2b     43
0x61fec0:       0x0061fedc      0x00000008      0x772c8023      0x772c801a
0x61fed0:       0xe53b01b1      0x004012d0      0x004012d0      0x30303030
0x61fee0:       0x31313131      0x31313131      0x31313131      0x31313131
0x61fef0:       0x32323232      0x32323232      0x32323232      0x32323232
0x61ff00:       0x33333333      0x33333333      0x33333333      0x33333333
0x61ff10:       0x34343434      0x34343434      0x34343434      0x00003635
=&gt; 0x401432 &lt;main+34&gt;:  mov    eax,DWORD PTR [esp+0x5c]
   0x401436 &lt;main+38&gt;:  test   eax,eax

Breakpoint 2, 0x00401432 in main ()
</code></pre></div></div>

<p>By continuing we see that the variable now contains <code class="language-plaintext highlighter-rouge">0x3635</code> or <code class="language-plaintext highlighter-rouge">13877</code> in decimal.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> <span class="nv">$ </span>c
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Continuing.
You changed the zero variable to 13877 (hex: 3635)![Inferior 1 (process 4848) exited normally]
Error while running hook_stop:
The program has no registers now.
</code></pre></div></div>

<p>In order to alter the <code class="language-plaintext highlighter-rouge">zero</code> variable we need to represent the number in the <code class="language-plaintext highlighter-rouge">little endian</code> form and write the corresponding bytes to the 65, 66, 67 and 68 offsets in in buffer.</p>

<h2 id="protection-against-buffer-overflows">Protection against buffer overflows</h2>

<p>Compilers and operating systems have some techniques to prevent such stack exploits. In <code class="language-plaintext highlighter-rouge">gcc</code>, for example, if the function allocates a buffer on the stack, an additional so-called <code class="language-plaintext highlighter-rouge">stack canary</code> is added. A stack canary is just a random integer generated when the function is called. Before returning the function makes sure that the canary has the same value. If the canary has been altered, the program is terminated with a fatal <code class="language-plaintext highlighter-rouge">Stack smashing detected</code> error.</p>

<p>Another technique used by operating systems is restricting code evaluation on the stack. When the stack overflow is exploited, hackers will try to overwrite the return address so that it points at the buffer location with the malicious code injected. Even if the exact address is not known, it is possible to construct a <code class="language-plaintext highlighter-rouge">NO-OP</code>-instruction slide in the stack buffer so that a jump at any address within this slide will lead to malicious code execution. Exact stack addresses are typically different after every program run because operating systems push environmental variables onto it.</p>

  
</article>



  <hr class="dingbat related mb6" />






  
     


  <aside class="about related mt4 mb4" role="complementary">
    
    

<div class="author mt4">
  

  
    


<img
  
    src="/assets/icons/icon.png"
    srcset="/assets/icons/logo_128.png 1x,/assets/icons/logo_256.png 2x"
    
  
  alt="Alexander Mayorov"
  class="avatar"
  
  width="120"
  height="120"
  loading="lazy"
/>

  

  
  
  <h2  class="page-title hr-bottom">
    About
  </h2>

  <p>Computer Science student &amp; backend developer</p>


  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/ZeroBone" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:zb@zerobone.net" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://t.me/zerobone" title="Telegram" class="no-mark-external">
      <span class="icon-telegram"></span>
      <span class="sr-only">Telegram</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.linkedin.com/in/zerobone" title="LinkedIn" class="no-mark-external">
      <span class="icon-linkedin2"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://instagram.com/zerobonezb" title="Instagram" class="no-mark-external">
      <span class="icon-instagram"></span>
      <span class="sr-only">Instagram</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>

  </aside>


  

  
    


  <aside class="other-projects related mb0" role="complementary">  <h2>Related Posts</h2>  <div class="columns">          <div class="column column-1-2">                  <article class="project-card">  <a href="/blog/cs/ip-pspace/" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine flip-project-img">              <img      src="/assets/img/blog/ip-pspace-tmb.jpg"    srcset="/assets/img/blog/ip-pspace-tmb.jpg 1280w,/assets/img/blog/ip-pspace-tmb@0,5x.jpg 640w,/assets/img/blog/ip-pspace-tmb@0,25x.jpg 320w,/assets/img/blog/ip-pspace-tmb@0,125x.jpg 160w"    sizes="(min-width:86em)27.5rem,(min-width:54em)24.5rem,(min-width:42em)21.5rem,42rem"    alt="Visualization and detailed description of the interactive protocol for TQBF yielding IP = PSPACE"      width="864"  height="486"  loading="lazy"/>          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/blog/cs/ip-pspace/" class="flip-title">Visualization and detailed description of the interactive protocol for TQBF yielding IP = PSPACE</a>  </h3>      <a class="fill-card no-hover" href="/blog/cs/ip-pspace/" tabindex="-1"><span class="sr-only">Continue reading Visualization and detailed description of the interactive protocol for TQBF yielding IP = PSPACE</span></a></article>              </div>          <div class="column column-1-2">                  <article class="project-card">  <a href="/blog/cs/restricted-injective-mapping-np-complete/" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine flip-project-img">              <img      src="/assets/img/blog/restricted-injective-mapping-np-complete.jpg"    srcset="/assets/img/blog/restricted-injective-mapping-np-complete.jpg 1920w,/assets/img/blog/restricted-injective-mapping-np-complete@0,5x.jpg 960w,/assets/img/blog/restricted-injective-mapping-np-complete@0,25x.jpg 480w,/assets/img/blog/restricted-injective-mapping-np-complete@0,125x.jpg 240w"    sizes="(min-width:86em)27.5rem,(min-width:54em)24.5rem,(min-width:42em)21.5rem,42rem"    alt="Finding an injective mapping with restrictions for values is NP-Complete"      width="864"  height="486"  loading="lazy"/>          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/blog/cs/restricted-injective-mapping-np-complete/" class="flip-title">Finding an injective mapping with restrictions for values is NP-Complete</a>  </h3>      <a class="fill-card no-hover" href="/blog/cs/restricted-injective-mapping-np-complete/" tabindex="-1"><span class="sr-only">Continue reading Finding an injective mapping with restrictions for values is NP-Complete</span></a></article>              </div>      </div></aside>

  

  
    


  <aside class="other-projects related mb0" role="complementary">  <h2>Random Posts</h2>  <div class="columns">        <div class="column column-1-2">            <article class="project-card">  <a href="/blog/cs/kadane-algorithm/" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine flip-project-img">              <img      src="/assets/img/blog/kadane-algorithm-tmb.jpg"    srcset="/assets/img/blog/kadane-algorithm-tmb.jpg 1280w,/assets/img/blog/kadane-algorithm-tmb@0,5x.jpg 640w,/assets/img/blog/kadane-algorithm-tmb@0,25x.jpg 320w,/assets/img/blog/kadane-algorithm-tmb@0,125x.jpg 160w"    sizes="(min-width:86em)27.5rem,(min-width:54em)24.5rem,(min-width:42em)21.5rem,42rem"    alt="Kadane's algorithm and the idea behind it"      width="864"  height="486"  loading="lazy"/>          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/blog/cs/kadane-algorithm/" class="flip-title">Kadane's algorithm and the idea behind it</a>  </h3>      <a class="fill-card no-hover" href="/blog/cs/kadane-algorithm/" tabindex="-1"><span class="sr-only">Continue reading Kadane's algorithm and the idea behind it</span></a></article>          </div>        <div class="column column-1-2">            <article class="project-card">  <a href="/blog/cs/ip-pspace/" class="no-hover no-print-link flip-project" tabindex="-1">    <div class="project-card-img aspect-ratio sixteen-nine flip-project-img">              <img      src="/assets/img/blog/ip-pspace-tmb.jpg"    srcset="/assets/img/blog/ip-pspace-tmb.jpg 1280w,/assets/img/blog/ip-pspace-tmb@0,5x.jpg 640w,/assets/img/blog/ip-pspace-tmb@0,25x.jpg 320w,/assets/img/blog/ip-pspace-tmb@0,125x.jpg 160w"    sizes="(min-width:86em)27.5rem,(min-width:54em)24.5rem,(min-width:42em)21.5rem,42rem"    alt="Visualization and detailed description of the interactive protocol for TQBF yielding IP = PSPACE"      width="864"  height="486"  loading="lazy"/>          </div>  </a>  <h3 class="project-card-title flip-project-title">    <a href="/blog/cs/ip-pspace/" class="flip-title">Visualization and detailed description of the interactive protocol for TQBF yielding IP = PSPACE</a>  </h3>      <a class="fill-card no-hover" href="/blog/cs/ip-pspace/" tabindex="-1"><span class="sr-only">Continue reading Visualization and detailed description of the interactive protocol for TQBF yielding IP = PSPACE</span></a></article>          </div>      </div></aside>

  

  
    
<aside class="comments related" role="complementary">
  <h2 class="hr-bottom">Comments</h2>
  

<div id="disqus_thread"></div>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
<script>!function(w, d) {
  if (d.getElementById("disqus_thread")) {
    if (w.DISQUS) {
      w.DISQUS.reset({
        reload: true,
        config() {
          this.page.url = w.location.href;
          this.page.title = d.title;
        },
      });
    } else {
      w.disqus_config = function disqusConfig() {
        this.page.url = w.location.href;
        this.page.title = d.title;
      };
      w.loadJSDeferred(d.getElementById("_hrefDisqus").href + '/embed.js');
    }
  }
}(window, document);</script>


</aside>


  


  
<footer class="content" role="contentinfo">
  <hr/>
  
    <p><small class="copyright">Copyright © 2019 — 2022 Alexander Mayorov. All rights reserved.
</small></p>
  
  
    <nav class="legal"><small>
    
      
      <a class="heading flip-title" href="/legal/cookies/">Cookies Policy</a>
      
    
    </small></nav>
  
  
  <hr class="sr-only"/>
</footer>


</main>

  <hy-drawer
  id="_drawer"
  class=""
  side="left"
  threshold="10"
  noscroll
  
>
  <header id="_sidebar" class="sidebar" role="banner">
    




<div class="sidebar-bg " style="background:rgb(10,41,132)"></div>

    <div class="sidebar-sticky">
  <div class="sidebar-about">
    
      <a class="no-hover" href="/" tabindex="-1">
        <img src="/assets/icons/icon.png" class="avatar" alt="ZeroBone" width="120" height="120" loading="lazy" />
      </a>
    
    <a class="sidebar-title" href="/"><h2 class="h1">ZeroBone</h2></a>
    
    
      <p class="">
        I am a computer science student and a backend developer

      </p>
    
  </div>

  <nav class="sidebar-nav heading" role="navigation">
    <span class="sr-only">Navigation:</span>
<ul>
  
    
      
      <li>
        <a
          id="_drawer--opened"
          href="/blog/"
          class="sidebar-nav-item "
          
        >
          Blog
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/projects/"
          class="sidebar-nav-item "
          
        >
          Projects
        </a>
      </li>
    
      
      <li>
        <a
          
          href="/cv/"
          class="sidebar-nav-item "
          
        >
          CV
        </a>
      </li>
    
  
</ul>

  </nav>

  
  <div class="sidebar-social">
    <span class="sr-only">Social:</span>
<ul>
  
    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://github.com/ZeroBone" title="GitHub" class="no-mark-external">
      <span class="icon-github"></span>
      <span class="sr-only">GitHub</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="mailto:zb@zerobone.net" title="Email" class="no-mark-external">
      <span class="icon-mail"></span>
      <span class="sr-only">Email</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://t.me/zerobone" title="Telegram" class="no-mark-external">
      <span class="icon-telegram"></span>
      <span class="sr-only">Telegram</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://www.linkedin.com/in/zerobone" title="LinkedIn" class="no-mark-external">
      <span class="icon-linkedin2"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  </li>


    
      



  

  
  
  
  

  

  

  <li>
    <a href="https://instagram.com/zerobonezb" title="Instagram" class="no-mark-external">
      <span class="icon-instagram"></span>
      <span class="sr-only">Instagram</span>
    </a>
  </li>


    
  
</ul>

  </div>
</div>
  </header>
</hy-drawer>
<hr class="sr-only" hidden />

</hy-push-state>


  <!--[if gt IE 10]><!---->
  <script nomodule>!function(){var t,n=document.createElement("script");!("noModule"in n)&&"onbeforeload"in n&&(t=!1,document.addEventListener("beforeload",function(e){if(e.target===n)t=!0;else if(!e.target.hasAttribute("nomodule")||!t)return;e.preventDefault()},!0),n.type="module",n.src=".",document.head.appendChild(n),n.remove())}();
</script>
  <script src="/assets/js/hydejack-9.1.6.js" type="module"></script>
  <script src="/assets/js/LEGACY-hydejack-9.1.6.js" nomodule defer></script>
  

  
  <script>!function(w, d) {
    w.ga=w.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;

    /**/
      if (navigator.CookiesOK) {
        ga('create', 'UA-76998425-9', 'auto');
      } else if (d.cookie.indexOf("hy--cookies-ok=true") > -1) {
        ga('create', 'UA-76998425-9', {
          'storage': 'none',
          'clientId': localStorage ? localStorage.getItem('ga--client-id') : undefined
        });
      } else {
        ga('create', 'UA-76998425-9', {
          'storage': 'none'
        });
        ga('set', 'forceSSL', true);
        ga('set', 'anonymizeIp', true);
      }
    /**/

    var pushStateEl = d.getElementById('_pushState');
    var timeoutId;
    pushStateEl.addEventListener('hy-push-state-load', function() {
      w.clearTimeout(timeoutId);
      timeoutId = w.setTimeout(function() {
        ga('set', 'page', w.location.pathname);
        ga('send', 'pageview');
      }, 500);
    });

    d.addEventListener('hy--cookies-ok', function () {
      w.ga(function(tracker) {
        w.ga("set", "anonymizeIp", undefined);
        localStorage && localStorage.setItem("ga--client-id", tracker.get("clientId"));
      });
    });

    w.loadJSDeferred('https://www.google-analytics.com/analytics.js');
  }(window, document);</script>


  <script type="module">
    if ('serviceWorker' in navigator) {
      /**/
      navigator.serviceWorker.getRegistration()
        .then(r => r.unregister())
        .catch(() => {});
      /**/
    }
  </script>
<!--<![endif]-->
  <!-- <script>
  document.querySelector('hy-push-state').setAttribute('prefetch', '');

  document.querySelectorAll('.sidebar a[href^="/"]').forEach(function (el) { 
    el.addEventListener('click', function (e) {
      if (el.pathname === window.location.pathname) {
        e.preventDefault();
        e.stopPropagation();
        document.querySelector('hy-drawer').close();
      }
    });
  });
</script> -->

<!--
Code for integrating CloudFlare's email protection with Hydejack's single page app loading.
-->
<script>
  document.getElementById('_pushState').addEventListener('hy-push-state-after', function (e) {
    function e(e){
      (console.error?console.error:console.log).call(console,e)
    }

    function t(e){
      return l.innerHTML='<a href="'+e.replace(/"/g,"&quot;")+'"></a>',l.childNodes[0].getAttribute("href")
    }

    function r(e,t){
      var r=e.substr(t,2);return parseInt(r,16)
    }

    function n(e,n){
      for(var o="",c=r(e,n),a=n+2;a<e.length;a+=2){
        var l=r(e,a)^c;
        o+=String.fromCharCode(l)
      }
      return t(o)
    }

    var o="/cdn-cgi/l/email-protection#",
        c=".__cf_email__",
        a="data-cfemail",
        l=document.createElement("div");

    !function(){
      for(var t=document.getElementsByTagName("a"),r=0;r<t.length;r++)
        try{
          var c=t[r],a=c.href.indexOf(o);
          a>-1&&(c.href="mailto:"+n(c.href,a+o.length))
        }catch(t){
          e(t)
        }
    }(),
    function(){
      for(var t=document.querySelectorAll(c),r=0;r<t.length;r++)
        try{
          var o=t[r],l=n(o.getAttribute(a),0),i=document.createTextNode(l);
          o.parentNode.replaceChild(i,o)
        }catch(t){
          e(t)
        }
    }()
  });
</script>





<div hidden>
  
  <h2 class="sr-only">Templates (for web app):</h2>

  <template id="_animation-template">
  <div class="animation-main fixed-top">
    <nav id="breadcrumbs" class="screen-only"><ul>
  
  
</ul></nav>
    <div class="content">
      <div class="page"></div>
    </div>
  </div>
</template>

  <template id="_loading-template">
  <div class="loading nav-btn fr">
    <span class="sr-only">Loading…</span>
    <span class="icon-cog"></span>
  </div>
</template>

  <template id="_error-template">
  <div class="page">
    <h1 class="page-title">Oops</h1>
    
    
    <p class="lead">
      Oops, an error occurred while loading <a class="this-link" href=""></a>.

    </p>
  </div>
</template>

  <template id="_permalink-template">
  <a href="#" class="permalink">
    <span class="sr-only">Permalink</span>
    <span class="content-hash"></span>
  </a>
</template>

  
    <template id="_cookies-banner-template">
  <div id="_cookies-banner" class="navbar fixed-bottom CookiesOK">
    <div class="content">
      <div class="nav-btn-bar">
        <small class="faded">
          <span>This site uses cookies. For more information, see the <a href="/legal/cookies/">Cookies Policy</a>.
</span>
          <button id="_cookies-ok" class="btn btn-primary btn-sm">Ok</button>
        </small>
      </div>
    </div>
  </div>
</template>

  
  
    <template id="_dark-mode-template">
  <button id="_dark-mode" class="nav-btn no-hover" >
    <span class="sr-only">Dark Mode</span>
    <span class="icon-brightness-contrast"></span>
  </button>
</template>

  
  
    <template id="_search-template">
  <button id="_search" class="nav-btn no-hover">
    <label class="sr-only" for="_search-input">Search</label>
    <span class="icon-search"></span>
  </button>
  <div id="_search-box">
    <div class="nav-btn">
      <span class="icon-search"></span>
    </div>
    <input 
      id="_search-input"
      type="search"
      class="form-control form-control-lg nav-btn"
      placeholder="Build with JEKYLL_ENV=production to enable search."
    />
    <button type="reset" class="nav-btn no-hover">
      <span class="sr-only">Close</span>
      <span class="icon-cross"></span>
    </button>
  </div>
  <div id="_hits"></div>
</template>

  
</div>

</body>
</html>
